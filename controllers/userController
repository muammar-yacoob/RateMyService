const asyncHandler = require('express-async-handler');
const User = require('../models/userModel');

//@desc Get all users
//@route GET /api/users
//@access Public
const getAllUsers = asyncHandler(async (req, res) => {
    try{
        const users = await User.find();
        res.status(200).json(users);
    }
    catch(err){
        res.status(500).json({error: err.message});
    }
});

const getUser = asyncHandler(async (req, res) => {
    try{
        const user = await User.findOne({email: req.params.email});
        res.status(200).json(user);
    }
    catch(err){
        res.status(500).json({error: err.message});
    }
});

const createUser = asyncHandler(async (req, res) => {
    console.log(req.body);
    const { name, email } = req.body;

    if (!name || !email) {
        res.status(400);
        throw new Error("All fields are mandatory !");
    }
    try {
        // Create a user object to pass to User.create()
        const userData = { name, email };
        const user = await User.create(userData);
        res.status(201).json(`${name} created successfully`);
    } catch(err) {
        res.status(500).json({ error: err.message });
    }
});


const updateUser = asyncHandler(async (req, res) => {
    res.status(200).json({success: true, msg: `Update user ${req.params.id}`});
});

const deleteUser = asyncHandler(async(req, res) => {
    res.status(200).json({success:  true, msg: `Delete  user ${req.params.id}`});
});

module.exports = {getAllUsers, getUser, createUser, updateUser,deleteUser};